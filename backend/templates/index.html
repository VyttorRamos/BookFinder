<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <title>BookFinder</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/BookFinderIcon.png') }}">
</head>

<body>
    <main>
        <h1>Bem-vindo ao BookFinder</h1>
        <p>Encontre seus livros favoritos de forma r√°pida e f√°cil. Explore nosso cat√°logo e descubra novas leituras para
            todos os gostos.</p>

        <div class="search-container">
            <form id="search-form">
                <input type="text" id="search-input" placeholder="Busque por t√≠tulo, autor ou categoria...">
                <button type="submit">üîç Buscar</button>
            </form>
        </div>

        <section id="destaques" class="book-section">
            <h2>üìö Livros em Destaque</h2>
            
            {% if livros %}
            <div class="book-grid">
                {% for livro in livros %}
                <div class="book-card" data-titulo="{{ livro.titulo.lower() }}" 
                     data-categoria="{{ livro.categoria_nome.lower() if livro.categoria_nome else '' }}"
                     data-autor="{{ livro.autor.lower() if livro.autor else '' }}">
                    <div class="book-card-image">
                        {% if livro.capa %}
                            <img src="{{ livro.capa }}" alt="Capa do livro {{ livro.titulo }}">
                        {% else %}
                            <div class="book-placeholder">
                                üìñ
                            </div>
                        {% endif %}
                    </div>
                    <div class="book-card-info">
                        <h3>{{ livro.titulo }}</h3>
                        <p class="book-author">
                            {% if livro.autor %}
                                {{ livro.autor }}
                            {% else %}
                                Autor n√£o informado
                            {% endif %}
                        </p>
                        <p class="book-year">
                            {% if livro.ano_publicacao %}
                                {{ livro.ano_publicacao }}
                            {% endif %}
                        </p>
                        <p class="book-category">
                            {% if livro.categoria_nome %}
                                {{ livro.categoria_nome }}
                            {% elif livro.genero %}
                                {{ livro.genero }}
                            {% endif %}
                        </p>
                        
                        <!-- Bot√£o Emprestar -->
                        <button class="btn-emprestar" onclick="abrirModalEmprestimo({{ livro.id_livro }}, '{{ livro.titulo }}')">
                            üìö Emprestar
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="no-books">
                <p>üìö Ainda n√£o h√° livros cadastrados no sistema.</p>
                <a href="{{ url_for('cadastrarlivro') }}" class="btn-primary">Cadastrar Primeiro Livro</a>
            </div>
            {% endif %}
        </section>

        <div class="feature-card">
            <h3>üîç Buscar Livros Online</h3>
            <p>Explore milhares de livros usando a API do Google Books</p>
            <a href="{{ url_for('buscar_livros') }}" class="btn-primary">Buscar na API</a>
        </div>

        <!-- Modal para Empr√©stimo -->
        <div id="modalEmprestimo" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>üìö Realizar Empr√©stimo</h3>
                <p id="livroInfo"></p>
                
                <form id="formEmprestimo">
                    <input type="hidden" id="livroId" name="livro_id">
                    
                    <div class="form-group">
                        <label for="usuarioSelect">Selecione o usu√°rio:</label>
                        <select id="usuarioSelect" name="usuario_id" required>
                            <option value="">Selecione um usu√°rio...</option>
                            {% for usuario in usuarios %}
                            <option value="{{ usuario.id_usuario }}">
                                {{ usuario.nome_completo }} - {{ usuario.email }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">‚úÖ Confirmar Empr√©stimo</button>
                        <button type="button" class="btn-secondary" onclick="fecharModal()">‚ùå Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </main>
</body>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
</html>